<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>AgentStream - AI Workflow Feed</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23e50914;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23b20710;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='200' height='200' fill='%23141414'/%3E%3Ccircle cx='100' cy='100' r='80' fill='none' stroke='url(%23g)' stroke-width='4'/%3E%3Cpath d='M 100 40 L 100 160 M 60 100 L 140 100' stroke='url(%23g)' stroke-width='4' stroke-linecap='round'/%3E%3Ccircle cx='100' cy='100' r='15' fill='url(%23g)'/%3E%3C/svg%3E">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Splash Screen -->
    <div id="splash-screen" class="splash-screen active">
        <div class="splash-content">
            <div class="logo-container">
                <svg class="logo-svg" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#e50914;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#b20710;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <circle cx="100" cy="100" r="80" fill="none" stroke="url(#logoGradient)" stroke-width="4"/>
                    <path d="M 100 40 L 100 160 M 60 100 L 140 100" stroke="url(#logoGradient)" stroke-width="4" stroke-linecap="round"/>
                    <circle cx="100" cy="100" r="15" fill="url(#logoGradient)"/>
                </svg>
                <h1 class="splash-title">AgentStream</h1>
            </div>
            <div class="splash-loader">
                <div class="loader-bar" id="splash-progress-bar"></div>
            </div>
            <p class="splash-progress-text" id="splash-progress-text">Loading... 0%</p>
        </div>
    </div>

    <!-- Login Screen -->
    <div id="login-screen" class="screen">
        <div class="login-container glass-panel">
            <div class="logo-small">
                <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="logoGradient2" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#e50914;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#b20710;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <circle cx="100" cy="100" r="80" fill="none" stroke="url(#logoGradient2)" stroke-width="4"/>
                    <path d="M 100 40 L 100 160 M 60 100 L 140 100" stroke="url(#logoGradient2)" stroke-width="4" stroke-linecap="round"/>
                    <circle cx="100" cy="100" r="15" fill="url(#logoGradient2)"/>
                </svg>
            </div>
            <h2>Welcome to AgentStream</h2>
            <p class="subtitle">Your personalized AI workflow feed</p>
            
            <div class="login-methods">
                <div class="api-key-instructions">
                    <p>To get started, you'll need a Gemini API key from Google AI Studio.</p>
                </div>
                
                <div class="manual-key-input">
                    <label for="manual-api-key" class="input-label">Gemini API Key</label>
                    <input type="password" id="manual-api-key" placeholder="Enter your API key (e.g., AIza...)" class="input-field">
                    <button id="manual-login-btn" class="btn btn-primary btn-full">Get Started</button>
                </div>
            </div>
            
            <p class="help-text">
                <svg viewBox="0 0 24 24" width="16" height="16" style="vertical-align: middle; margin-right: 5px;">
                    <path fill="currentColor" d="M11 17h2v-6h-2v6zm1-15C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM11 9h2V7h-2v2z"/>
                </svg>
                Get your free API key from <a href="https://aistudio.google.com/app/apikey" target="_blank">Google AI Studio</a>
            </p>
        </div>
    </div>

    <!-- Profile Selection Screen -->
    <div id="profile-screen" class="screen">
        <div class="profile-container">
            <h2>Who's exploring today?</h2>
            <div id="profile-list" class="profile-list"></div>
            <button id="add-profile-btn" class="btn btn-secondary">+ Add Profile</button>
        </div>
    </div>

    <!-- Welcome Screen (First Time) -->
    <div id="welcome-modal" class="modal">
        <div class="modal-content glass-panel welcome-panel">
            <div class="welcome-header">
                <div class="logo-welcome">
                    <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="logoGradient3" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#e50914;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#b20710;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        <circle cx="100" cy="100" r="80" fill="none" stroke="url(#logoGradient3)" stroke-width="4"/>
                        <path d="M 100 40 L 100 160 M 60 100 L 140 100" stroke="url(#logoGradient3)" stroke-width="4" stroke-linecap="round"/>
                        <circle cx="100" cy="100" r="15" fill="url(#logoGradient3)"/>
                    </svg>
                </div>
                <h2>Welcome to AgentStream</h2>
                <p class="welcome-subtitle">Your Personalized AI Workflow Feed</p>
            </div>
            
            <div class="welcome-content">
                <div class="welcome-section">
                    <h3>ðŸŽ¯ What is AgentStream?</h3>
                    <p>AgentStream is a Netflix-style feed of AI-powered workflows that adapt to your preferences. Discover, save, and execute intelligent workflows powered by Gemini 2.0 Flash.</p>
                </div>
                
                <div class="welcome-section">
                    <h3>âœ¨ Key Features</h3>
                    <ul class="welcome-list">
                        <li><strong>Discover Workflows:</strong> Browse AI-generated workflows across 15+ categories</li>
                        <li><strong>Smart Personalization:</strong> The more you save, the more tailored your feed becomes</li>
                        <li><strong>Execute & Interact:</strong> Run workflows and see live results</li>
                        <li><strong>Multiple Profiles:</strong> Switch profiles for different workflow experiences</li>
                    </ul>
                </div>
                
                <div class="welcome-section">
                    <h3>ðŸš€ Getting Started</h3>
                    <ol class="welcome-list">
                        <li>Enter your <strong>Gemini API Key</strong> from <a href="https://aistudio.google.com/app/apikey" target="_blank">Google AI Studio</a></li>
                        <li>Browse the workflow feed and tap any card to view details</li>
                        <li>Tap <strong>"Use Workflow"</strong> to save workflows you like</li>
                        <li>Saved workflows personalize your feed over time</li>
                        <li>Tap <strong>"Run Workflow"</strong> to execute and see results</li>
                    </ol>
                </div>
                
                <div class="welcome-section">
                    <h3>ðŸ’¡ Pro Tips</h3>
                    <ul class="welcome-list">
                        <li>Save at least 3-5 workflows to activate personalization</li>
                        <li>Each profile has its own personalized feed</li>
                        <li>Workflows are never identical - always fresh and unique</li>
                        <li>Tap the refresh button to generate new workflows</li>
                    </ul>
                </div>
            </div>
            
            <div class="modal-actions">
                <button id="start-exploring-btn" class="btn btn-primary btn-large">Start Exploring</button>
            </div>
        </div>
    </div>

    <!-- Feed Preference Prompt -->
    <div id="preference-modal" class="modal">
        <div class="modal-content glass-panel">
            <h3>Personalize Your Feed</h3>
            <p>You have saved workflows! Would you like me to personalize your feed based on your preferences?</p>
            <div class="modal-actions">
                <button id="use-saved-btn" class="btn btn-primary">Yes, personalize my feed</button>
                <button id="keep-stock-btn" class="btn btn-secondary">No, keep exploring</button>
            </div>
        </div>
    </div>

    <!-- Main App Screen -->
    <div id="app-screen" class="screen">
        <!-- Header -->
        <header class="app-header">
            <div class="header-left">
                <button id="hamburger-btn" class="btn-icon hamburger-btn">
                    <svg viewBox="0 0 24 24" width="24" height="24">
                        <path fill="currentColor" d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </button>
                <h1 class="app-title">AgentStream</h1>
            </div>
            <div class="header-right">
                <button id="refresh-header-btn" class="btn-icon">
                    <svg viewBox="0 0 24 24" width="24" height="24">
                        <path fill="currentColor" d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                    </svg>
                </button>
            </div>
        </header>

        <!-- Hamburger Menu -->
        <div id="hamburger-menu" class="hamburger-menu">
            <div class="hamburger-menu-overlay"></div>
            <div class="hamburger-menu-content glass-panel">
                <div class="menu-header">
                    <h3>Menu</h3>
                    <button id="close-menu-btn" class="btn-close">Ã—</button>
                </div>
                
                <div class="menu-section">
                    <div class="menu-section-title">Current Profile</div>
                    <div id="current-profile-info" class="current-profile-info">
                        <div class="profile-avatar-small">U</div>
                        <div class="profile-info-text">
                            <div class="profile-name-small">User</div>
                            <div class="profile-email-small">user@example.com</div>
                        </div>
                    </div>
                </div>
                
                <div class="menu-divider"></div>
                
                <div class="menu-section">
                    <button id="menu-switch-profile" class="menu-item">
                        <svg viewBox="0 0 24 24" width="24" height="24">
                            <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
                        </svg>
                        <span>Switch Profile</span>
                    </button>
                    
                    <button id="menu-add-profile" class="menu-item">
                        <svg viewBox="0 0 24 24" width="24" height="24">
                            <path fill="currentColor" d="M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-9-2V7H4v3H1v2h3v3h2v-3h3v-2H6zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                        </svg>
                        <span>Add New Profile</span>
                    </button>
                </div>
                
                <div class="menu-divider"></div>
                
                <div class="menu-section">
                    <button id="menu-saved-workflows" class="menu-item">
                        <svg viewBox="0 0 24 24" width="24" height="24">
                            <path fill="currentColor" d="M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2zm0 15l-5-2.18L7 18V5h10v13z"/>
                        </svg>
                        <span>Saved Workflows</span>
                        <span id="saved-count-badge" class="menu-badge">0</span>
                    </button>
                    
                    <button id="menu-clear-feed" class="menu-item">
                        <svg viewBox="0 0 24 24" width="24" height="24">
                            <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                        </svg>
                        <span>Clear Current Feed</span>
                    </button>
                    
                    <button id="menu-reset-preferences" class="menu-item">
                        <svg viewBox="0 0 24 24" width="24" height="24">
                            <path fill="currentColor" d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/>
                        </svg>
                        <span>Reset Feed Preferences</span>
                    </button>
                </div>
                
                <div class="menu-divider"></div>
                
                <div class="menu-section">
                    <button id="menu-about" class="menu-item">
                        <svg viewBox="0 0 24 24" width="24" height="24">
                            <path fill="currentColor" d="M11 17h2v-6h-2v6zm1-15C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM11 9h2V7h-2v2z"/>
                        </svg>
                        <span>About AgentStream</span>
                    </button>
                    
                    <button id="menu-logout" class="menu-item danger">
                        <svg viewBox="0 0 24 24" width="24" height="24">
                            <path fill="currentColor" d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
                        </svg>
                        <span>Logout</span>
                    </button>
                </div>
                
                <div class="menu-footer">
                    <small>AgentStream v1.0.0</small>
                </div>
            </div>
        </div>

        <!-- Feed Container -->
        <div class="feed-container">
            <div class="feed-header">
                <h2 id="feed-title">Discovering Workflows for You</h2>
                <button id="refresh-feed-btn" class="btn btn-refresh">
                    <svg viewBox="0 0 24 24" width="20" height="20">
                        <path fill="currentColor" d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                    </svg>
                    Refresh Feed
                </button>
            </div>
            
            <div id="workflow-feed" class="workflow-feed">
                <!-- Workflow cards will be dynamically inserted here -->
            </div>
            
            <div id="loading-indicator" class="loading-indicator">
                <div class="spinner"></div>
                <p id="loading-text">Generating workflows...</p>
                <div class="loading-progress">
                    <div class="loading-progress-bar" id="loading-progress-bar"></div>
                </div>
                <p class="loading-percentage" id="loading-percentage">0%</p>
            </div>
        </div>
    </div>

    <!-- Workflow Execution Modal -->
    <div id="execution-modal" class="modal">
        <div class="modal-content execution-panel glass-panel">
            <div class="modal-header">
                <h3 id="execution-title">Workflow Execution</h3>
                <button id="close-execution-btn" class="btn-close">Ã—</button>
            </div>
            <div id="execution-content" class="execution-content">
                <!-- Workflow execution details will be shown here -->
            </div>
            <div id="execution-actions" class="execution-actions">
                <button id="run-workflow-btn" class="btn btn-primary">Run Workflow</button>
                <button id="stop-workflow-btn" class="btn btn-danger" style="display: none;">Stop</button>
            </div>
        </div>
    </div>

    <!-- Saved Workflows Modal -->
    <div id="saved-workflows-modal" class="modal">
        <div class="modal-content glass-panel saved-workflows-panel">
            <div class="modal-header">
                <h3>Saved Workflows</h3>
                <button id="close-saved-workflows-btn" class="btn-close">Ã—</button>
            </div>
            <div id="saved-workflows-content" class="saved-workflows-content">
                <!-- Saved workflows will be rendered here -->
            </div>
        </div>
    </div>

    <!-- File Viewer/Runner Modal -->
    <div id="file-viewer-modal" class="modal">
        <div class="modal-content glass-panel file-viewer-panel">
            <div class="modal-header">
                <h3 id="file-viewer-title">Output Viewer</h3>
                <button id="close-file-viewer-btn" class="btn-close">Ã—</button>
            </div>
            <div class="file-viewer-toolbar">
                <div class="toolbar-left">
                    <select id="file-type-selector" class="file-type-select">
                        <option value="text">Plain Text</option>
                        <option value="code">Code</option>
                        <option value="json">JSON</option>
                        <option value="markdown">Markdown</option>
                        <option value="html">HTML Preview</option>
                    </select>
                </div>
                <div class="toolbar-right">
                    <button id="format-output-btn" class="btn-toolbar" title="Format/Pretty Print">
                        <svg viewBox="0 0 24 24" width="18" height="18">
                            <path fill="currentColor" d="M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"/>
                        </svg>
                    </button>
                    <button id="copy-viewer-btn" class="btn-toolbar" title="Copy All">
                        <svg viewBox="0 0 24 24" width="18" height="18">
                            <path fill="currentColor" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                        </svg>
                    </button>
                    <button id="fullscreen-viewer-btn" class="btn-toolbar" title="Fullscreen">
                        <svg viewBox="0 0 24 24" width="18" height="18">
                            <path fill="currentColor" d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div id="file-viewer-content" class="file-viewer-content">
                <!-- File content will be rendered here -->
            </div>
            <div class="file-viewer-footer">
                <div class="viewer-stats">
                    <span id="char-count">0 characters</span>
                    <span class="divider-dot">â€¢</span>
                    <span id="line-count">0 lines</span>
                    <span class="divider-dot">â€¢</span>
                    <span id="word-count">0 words</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container"></div>

    <script src="js/config.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/google-auth.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/gemini.js"></script>
    <script src="js/workflows.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/app.js"></script>
</body>
</html>

